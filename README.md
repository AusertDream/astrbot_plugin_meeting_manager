# 课题组组会管理插件

适配对象：AstrBot 插件

## 功能特性

### 🔔 智能定时提醒功能
- **多任务支持**：支持配置多个不同的提醒任务
- **灵活时间设置**：支持精确到秒的定时提醒
- **智能重复**：支持按天、小时、分钟、秒的重复间隔
- **次数限制**：可设置重复次数，支持无限重复
- **实时状态**：可随时查看提醒任务状态和下次提醒时间
- **热重载**：支持运行时重新加载配置文件
- **测试功能**：支持手动测试提醒消息

### 📊 数据管理功能
- **成员管理**：管理课题组成员信息
- **Reading Group管理**：管理读书小组相关事务

## 使用说明

### 定时提醒相关命令

#### `/reminder_status`
查看所有提醒任务的当前状态，显示下次提醒时间

#### `/reminder_reload`
重新加载配置文件，适用于修改配置后无需重启插件

#### `/reminder_add`
添加新的提醒任务
```
用法: /reminder_add <名称> <sid列表> <时间> <重复间隔> <重复次数> <消息>
示例: /reminder_add test1 [123,456] "2025-01-20 19:30:00" "7:00:00:00" 10 "测试提醒"
```

#### `/reminder_del`
删除指定的提醒任务
```
用法: /reminder_del <名称>
示例: /reminder_del test1
```

#### `/reminder_list`
列出所有提醒任务的详细信息，包括状态、下次提醒时间等

### 其他命令

#### `/helloworld`
测试插件基本功能

#### `/data members`
成员管理相关操作

#### `/data reading_group`
Reading Group管理相关操作

## 配置文件说明

### config.yml 配置格式

```yaml
attention:
  # 提醒任务名称
  任务名称:
    sid: [用户ID1, 用户ID2, ...]  # 接收提醒的用户/群聊ID列表
    time: YYYY-MM-DD HH:MM:SS   # 首次提醒时间
    repeat: 天:时:分:秒          # 重复间隔
    repeat_times: 次数           # 重复次数，-1表示无限重复
    message: '提醒消息内容'      # 提醒消息
```

### 动态配置管理

插件支持两种配置方式：

1. **静态配置** (`config.yml`): 在配置文件中预先定义的提醒任务
2. **动态配置** (`dynamic_config.yml`): 通过指令动态添加的提醒任务

动态添加的提醒会自动保存到 `dynamic_config.yml` 文件中，重启插件后仍然有效。

### 配置参数详解

- **sid**: 接收提醒的用户/群聊ID列表，支持多个用户或群聊
- **time**: 首次提醒时间，格式为 `YYYY-MM-DD HH:MM:SS`
- **repeat**: 重复间隔，格式为 `天:时:分:秒`
  - 例如：`7:00:00:00` 表示每7天重复一次
  - 例如：`1:00:00:00` 表示每天重复一次
  - 例如：`0:02:00:00` 表示每2小时重复一次
  - 例如：`0:00:00:00` 表示不重复，只提醒一次
- **repeat_times**: 重复次数
  - 正整数：指定重复次数
  - -1：无限重复
- **message**: 提醒消息内容

### 配置示例

```yaml
attention:
  # 每周组会提醒
  weekly_meeting:
    sid: [123, 456, 789]
    time: 2025-01-20 19:30:00
    repeat: "7:00:00:00"
    repeat_times: 100
    message: '还有半小时就要组会啦！请做好准备。'
    
  # 每日打卡提醒
  daily_checkin:
    sid: [123, 456]
    time: 2025-01-20 09:00:00
    repeat: "1:00:00:00"
    repeat_times: -1
    message: '早上好！请记得打卡签到。'
    
  # 一次性提醒
  project_deadline:
    sid: [123]
    time: 2025-02-01 10:00:00
    repeat: "0:00:00:00"
    repeat_times: 1
    message: '项目截止日期快到了，请抓紧时间完成！'
```

## 技术实现

- 使用 `asyncio` 实现异步定时任务
- 基于 `datetime` 模块精确计算下次提醒时间
- 支持插件热重载和优雅关闭
- 完善的错误处理和日志记录
- 使用 `PyYAML` 解析配置文件

## 安装和部署

1. 确保已安装 Python 3.12+
2. 安装依赖：`pip install -r requirements.txt` 或使用 `uv sync`
3. 配置 `config.yml` 文件
4. 将插件部署到 AstrBot 插件目录
5. 重启 AstrBot 或重新加载插件

## 注意事项

1. **时间格式**：确保时间格式正确，使用24小时制
2. **用户ID**：确保用户ID正确，否则无法发送提醒
3. **重复间隔**：建议不要设置过短的重复间隔，避免频繁提醒
4. **配置文件**：修改配置文件后，使用 `/reminder_reload` 命令重新加载
5. **日志监控**：建议定期查看日志，确保提醒功能正常运行

## 故障排除

### 常见问题

1. **提醒不发送**
   - 检查配置文件格式是否正确
   - 确认用户ID是否正确
   - 查看日志是否有错误信息

2. **时间计算错误**
   - 检查时间格式是否正确
   - 确认时区设置

3. **重复次数不生效**
   - 检查 `repeat_times` 参数设置
   - 确认 `repeat` 间隔设置正确

### 日志查看

插件会记录详细的运行日志，包括：
- 配置文件加载状态
- 提醒任务启动/停止状态
- 消息发送成功/失败状态
- 错误信息和异常处理

## 支持

[帮助文档](https://astrbot.app)

如有问题或建议，请提交 Issue 或 Pull Request。
